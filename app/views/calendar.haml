.box-header{:style => "text-align: center; position: relative;"}
  =Time.now.strftime('%B')
  .calendartype{:style => "position: absolute; right: 15px; top: 10px; float: right"}
    .roundtab.list &nbsp;List&nbsp;
    .roundtab.month.toggled Month
    .roundtab.week Week
-@events = events_by_visible_month(@events, Time.now)
.box{:style => "padding: 0 0 15px 2%"}
  .month-calendar
    .header-cell Mon
    .header-cell Tues
    .header-cell Wed
    .header-cell Thurs
    .header-cell Fri
    .header-cell Sat
    .header-cell Sun
    -day = Time.now.beginning_of_month.beginning_of_week - 1.day
    -35.times do |i|
      -day += 1.day
      -format = (day.mon == Time.now.mon ? (day == Time.now.midnight ? "today" : "") : "lighter")
      -format += " ul" if i == 0
      -format += " ur" if i == 6
      -format += " lr" if i == 34
      -format += " ll" if i == 28
      
      .cell{:class => format}
        %a{:href => "/new-event?calendar_id=#{@calendar.id}&day=#{day.to_i}", :style => "position: absolute; display: block; width: 100%; height: 100%;"}
        .number= day.day
        -@events.find_all{|e| Time.at(e.date).midnight == day}.each do |event|
          %a.event{:href => "/event/#{event.permalink}"}= event.name
  .week-calendar{:style => "display: none;"}
    .header-cell Sun
    .header-cell Mon
    .header-cell Tues
    .header-cell Wed
    .header-cell Thurs
    .header-cell Fri
    .header-cell Sat
    -events_this_week = events_by_week(@events, Time.now)
    
    
    -day = Time.now.beginning_of_week - 1.day
    -7.times do |i|
      -day += 1.day
      -format = (day.mon == Time.now.mon ? (day == Time.now.midnight ? "today" : "") : "lighter")
      -format += " ul ll" if i == 0
      -format += " ur lr" if i == 6
      
      .cell.week{:class => format}
        .number= day.day
        -events_this_week.find_all{|e| Time.at(e.date).midnight == day}.each do |event|
          %a.event{:href => "/event/#{event.permalink}"}= event.name
  .list-calendar{:style => "display: none; padding: 10px;"}
    -if @events.empty?
      %p
        No Events.
    -else
      -@events.each do |event|
        %p
          %b= Time.at(event.date).strftime("%b %d")
          %a{:href => "/event/#{event.permalink}"}
            = event.name
    %a{:href => "/new-event?calendar_id=#{@calendar.id}", :style => "display: block; margin-top: 20px;"}
      .awesome.green.medium New Event
  %br.cl
  
:javascript
  $(document).ready(function(){
    $(".roundtab").click(function(){
      tab = $(this);
      $(".roundtab").removeClass("toggled");
      tab.addClass("toggled");
      if (tab.hasClass("month")){
        $(".week-calendar").hide();
        $(".list-calendar").hide();
        $(".month-calendar").show();
      } else if (tab.hasClass("week")) {
        $(".month-calendar").hide();
        $(".list-calendar").hide();
        $(".week-calendar").show();
      } else {
        $(".month-calendar").hide();
        $(".week-calendar").hide();
        $(".list-calendar").show();
      }
    });
  });