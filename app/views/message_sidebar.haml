.secondary-row-nohover.no-select
  &nbsp;
  .new-button.flush-right.browse-rooms Find a Room
  .new-button.flush-left.new-room New Room
-@rooms.sort_by{|r| -r.last_message.date}.each do |@room|
  =haml :room_row, :layout => false
      

:javascript
  var pusher = new Pusher('84d6245235e5b198d8aa');
  $(document).ready(function(){
    $("#smessages").children(".secondary-row").first().click();
    var modal = $(".modal");
    $(".new-room").click(function(){
      $(".modal-new").show();
      showModal();
    });
    $(".create-room").click(function(){
      var addedIDs = $(".added-ids").val();
      var newName = $(".new-name").val();
      $.post("/ui/create-room/", {'name': newName, 'ids': addedIDs}, function(data){
        $("#smessages").append(data);
        hideModal();
      });
    });
    $(".browse-rooms").click(function(){
      $(".modal-browse").show();
      showModal();
    });
    $(".shroud").click(function(){
      hideModal();
    });
    var newListener = pusher.subscribe('new_messages');
    newListener.bind('newMessage', function(data) {
      console.log("New message.");
      var room = data.room;
      var badge = $("#"+room).find(".badge");
      if ($("#"+room).hasClass("selected") || badge.length == 0) return false;
      badge.text(parseInt(badge.text()) + 1);
      badge.removeClass("clear").addClass("green");
    });
  });
  
  $(".join-room").live("click", function(){
    $.post($(this).attr("href"), function(data){
      $("#smessages").append(data);
      hideModal();
    });
  });
  function showModal(){
    $(".shroud").fadeIn(100);
    $(".modal-border").fadeIn(100);
    $(".modal").fadeIn(100);
  }
  
  function hideModal(){
    $(".shroud").fadeOut(50);
    $(".modal-border").fadeOut(50);
    $(".modal").fadeOut(50, function(){
      $(".modal-new").hide();
      $(".modal-browse").hide();
    });
  }
  
  $(document).keydown(function(e){
    if (e.keyCode == 27){ //escape
      hideModal();
    }
  });