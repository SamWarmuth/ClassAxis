!!!
%html{:xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %meta{:content => "text/html; charset=utf-8", "http-equiv" => "content-type"}/
    %link{:href => "/css/style.css", :media => "all", :rel => "stylesheet", :type => "text/css"}/
    %link{:href => "/css/jqui.css", :media => "all", :rel => "stylesheet", :type => "text/css"}/
    %title ClassAxis
    %script{:src => "/js/jquery-1.4.2.min.js", :type => "text/javascript"}
    %script{:src => "/js/jquery-ui-1.8.4.custom.min.js", :type => "text/javascript"}
    %script{:src => "/js/excanvas.js", :type => "text/javascript"}
    %script{:src => "/js/visualize.jQuery.js", :type => "text/javascript"}
    %script{:src => "/js/functions.js", :type => "text/javascript"}
  %body
    #header
      .header-top.tr
        .logo{:style => 'position: absolute; font-size: 1.2em; top: 4px;'}
          %a{:href => "/", :style => "text-decoration: none;"}
            %strong ClassAxis
        -if @user
          %p
            %strong= @user.name || @user.email
            |
            -unread_count = @user.messages.find_all{|m| m.unread == true}.count
            %a#opener.strong{:href => "#"} #{unread_count} new message#{"s" if unread_count != 1}
            |
            %a{:href => "#"} Settings
            |
            %a{:href => "/logout"} Logout
        -else
          %p
            You're not currently logged in.
            |
            %a{:href => "/login"} Log In
            |
            %a{:href => "/signup"} Sign Up
        #dialog{:title => "Messages"}
          -if @user.messages.empty?
            %p You have no messages.
          -@user.messages.find_all{|m| m.unread == true}.each do |message|
            .message.new
              %h4
                = message.subject
                %small.fr
                  #{Time.parse(message.date).to_s} from
                  -sender = User.get(message.sender_id)
                  %a{:href => "/user/#{sender.permalink}"}= sender.name
              %p= message.content
          -@user.messages.find_all{|m| m.unread != true}.each do |message|
            .message
              %h4
                = message.subject
                %small.fr
                  #{Time.parse(message.date).to_s} from
                  -sender = User.get(message.sender_id).name
                  %a{:href => "/user/#{sender.permalink}"}= sender.name
              %p= message.content
              
          %form{:action => "", :method => "post"}
            %h3 New Message
            %fieldset
              %label To:
              %input{:type => "text"}/
            %fieldset
              %textarea.textarea{:cols => "55", :name => "textfield", :rows => "5", :style => "width:97%"}
            %fieldset
              %input.button.medium.fr{:type => "submit", :value => "Send"}/
          / end write new message
        / end dialogue box
    #page-wrapper
      .page
        / Start Sidebar
        #sidebar
          / Start Live Search
          %form.searchform{:action => "#"}
            %input#livesearch.searchfield{:onblur => "if (this.value == '') {this.value = 'Live Search...';}", :onfocus => "if (this.value == 'Live Search...') {this.value = '';}", :type => "text", :value => "Live Search..."}/
            %input.searchbutton{:type => "button", :value => "Go"}/
          / End Live Search
          / Start Content Nav
          %span.ul-header
            %a#toggle-pagesnav.toggle.visible{:href => "#"} Courses
          %ul#pagesnav
            -@user.courses.each do |course|
              %li
                %a.icn_manage_pages{:href => "/course/" + course.permalink}= course.name
            %li
              %a.icn_edit_pages{:href => "/edit-course"} Create Course
            %li
              %a.icn_add_pages{:href => "/courses"} Browse Courses
          / End Content Nav
          / Start Comments Nav
          %span.ul-header
            %a#toggle-userssnav.toggle.visible{:href => "#"} Groups
          %ul#userssnav
            -@user.groups.each do |group|
              %li
                %a.icn_manage_users{:href => "/group/" + group.permalink}= group.name
            %li
              %a.icn_add_users{:href => "#"} Create Group
            %li
              %a.icn_manage_users{:href => "/groups"} Browse Groups
          %span.ul-header
            %a#toggle-commentsnav.toggle.visible{:href => "#"} Discussions
          %ul#commentsnav
            %li
              %a.icn_manage_comments{:href => "/discussions"} Browse Discussions
            %li
              %a.icn_add_comments{:href => "#"} New Discussion

          / End Users Nav
          / Start Gallery Nav
          %span.ul-header
            %a#toggle-imagesnav.toggle.visible{:href => "#"} Gallery
          %ul#imagesnav
            %li
              %a.icn_manage_image{:href => "#"} Manage Images
            %li
              %a.icn_add_image{:href => "#"} Add Images
            %li
              %a.icn_edit_image{:href => "#"} Edit Images
            %li
              %a.icn_delete_image{:href => "#"} Delete Images
          / End Gallery Nav
          / Start Statistics Area
          %span.ul-header Statistics
          %ul
            %li Users: #{User.count}
            %li Courses: #{Group.all.find_all{|g| !g.class_number.nil?}.count}
            %li Groups: #{Group.all.find_all{|g| g.class_number.nil?}.count}
            %li Discussions: #{Topic.count}
            %li Messages: #{Message.count}
            
            / End Statistics Area
        / End Sidebar
        / Star Page Content
        #page-content
          =yield
        
.footer
  Copyright Â©2010 ClassAxis