!!!
%html{:xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %meta{:content => "text/html; charset=utf-8", "http-equiv" => "content-type"}/
    %link{:href => "/css/style.css", :media => "all", :rel => "stylesheet", :type => "text/css"}/
    %link{:href => "/css/jqui.css", :media => "all", :rel => "stylesheet", :type => "text/css"}/
    %link{:href => "/css/autoSuggest.css", :media => "all", :rel => "stylesheet", :type => "text/css"}/
    
    %title Class Axis
    %script{:src => "/js/jquery-1.4.2.min.js", :type => "text/javascript"}
    %script{:src => "/js/jquery-ui-1.8.4.custom.min.js", :type => "text/javascript"}
    %script{:src => "/js/excanvas.js", :type => "text/javascript"}
    %script{:src => "/js/visualize.jQuery.js", :type => "text/javascript"}
    %script{:src => "/js/functions.js", :type => "text/javascript"}
    %script{:src => "/js/fileuploader.js", :type => "text/javascript"}
    
    
    
    %script{:src => "/js/jquery.autoSuggest.packed.js", :type => "text/javascript"}
    
    %script{:src => "/js/views/layout.js", :type => "text/javascript"}
    -#users = User.all.delete_if{|u| u.id == @user.id}.map{|user| "{value:'#{user.id}', name: '#{user.name}'}"}.join(",")
    -users = User.all.delete_if{|u| u.id == @user.id}.map{|user| "{label:'#{user.name}', id:'#{user.id}'}"}.join(",")
    
    
    :javascript
      var thing;
      $(document).ready(function(){
        var storedUsers = [#{users}];
        var users = storedUsers; //never modify storedUsers
        
        $(".auto-users").autocomplete({
          source: users,
          highlightItem: true,
          select: function( event, ui ) {
            var userList = $(".added-users");
            var idList = $(".added-ids");
            idList.val(idList.val() + " " + ui.item.id);
            thing = ui;
            
            if (userList.text() != "") userList.append(", ")
            userList.append(ui.item.label);
            return false;
          },
          change: function(event, ui) { return false;}
        });

          
        //$(".auto-users").autoSuggest(data.items, {selectedItemProp: "name", searchObjProps: "name", selectionAdded: function(elem){
        //  var index = parseInt($(elem).attr('id').charAt($(elem).attr('id').length-1));
        //}});
      });
      
    
    %script{:src => "http://js.pusherapp.com/1.6/pusher.min.js", :type => "text/javascript"}
  %body
    .shroud
    #page-wrapper
      .page
        -@user.broadcast_ids.map{|b_id| Broadcast.get(b_id)}.each do |broadcast|
          .notification{:class => broadcast.type}
            = broadcast.content.gsub("^^name^^", @user.name)
            .close{:id => broadcast.id}
        .page-content
          .modal-border
            .modal
              .modal-new.hide
                %h1.center{:style => "margin-top: 30px"} Create a New Room
                %form{:style => "margin: 25px; text-align: left;"}
                  .space{:style => "margin: 10px"}
                  %label.form-label Invite (name or email)
                  
                  %input.form-input.auto-users{:type => "text", :placeholder => "Who?", :style => "width: 125px; clear: both;"}
                  .added-users{:style => "display: inline-block; margin-left: 10px;"}
                  %input.added-ids{:type => "hidden"}
                  .space{:style => "margin: 10px"}
                  %label.form-label Room Name (optional)
                  %input.form-input{:type => "text", :placeholder => "What should it be called?"}
                  %br
                  %br
                  %br
                  .new-button.create-room.center{:style => "display: block;"} Create Room
              .modal-browse.hide
                %h1.center Find a Room
                %form{:style => "margin: 0px 15px;"}
                  %label.form-label Search
                  %input.form-input{:type => "text", :placeholder => "What subjects are you interested in?"}
                  .space{:style => "margin: 10px"}
                  .heading{:style => "display: inline-block; width: 165px; margin-left: 5px;"} Room Name
                  .heading{:style => "display: inline-block; width: 90px"} # Members
                  .heading{:style => "display: inline-block; width: 150px"} Last Message
                  
                  
                  .tableholder{:style => " height: 190px; width: 102%; overflow: auto;"}
                    %table
                      %tr
                        %th
                        %th{:style => "width: 70px"}
                        %th
                        %th{:style => 'width: 60px'}
                      -15.times do
                        %tr
                          %td{:style => "font-weight: bold"} Senior Design
                          %td{:style => "text-align: center"} 13
                          %td March 21st
                          %td 
                            .new-button.small Join
          .spinner
          .init-selected{:style => "display: none;"}= @selected
          .header-box= @selected
          -#.top-navigation
            //%a.icon.no-select#home home
            //%a.icon.no-select#discussions discussions
            //%a.icon.no-select#groups groups
            //%a.icon.no-select#events events
            //%a.icon.no-select#messages Conversations
          .secondary-container
            .secondary-navigation
              -if false
                #shome.hidden
                  .secondary-row.no-select#profile{:href => "/ui/profile"}
                    Profile
                    .page-title Profile
                  .secondary-row.no-select#news{:href => "/ui/news"}
                    Recent News
                    .page-title Recent News
                  .secondary-row.no-select#upcoming.selected{:href => "/ui/upcoming"}
                    This Week
                    .page-title This Week
                #sgroups.hidden
                  = haml :group_sidebar, :layout => false
                #sevents.hidden
                  = haml :event_sidebar, :layout => false
                #sdiscussions.hidden
                  = haml :discussion_sidebar, :layout => false
              #smessages.hidden
                = haml :message_sidebar, :layout => false
            .selected-content
              =yield
          %br.cl
        
      .footer
        Copyright Â©2011 Class Axis